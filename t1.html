<!DOCTYPE html>
<html>
<head>
  <title>AR.js GLTF Model</title>
  <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-assets>
      <a-asset-item id="model" src="./assets/asset.gltf"></a-asset-item>
    </a-assets>
    <a-marker preset="hiro">
      <a-entity
        gltf-model="#model"
        scale="0.1 0.1 0.1"
      ></a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // Get latitude and longitude from the construction site coordinates
    const latitude = 39.880675;
    const longitude = 32.835736;

    // Function to convert geographic coordinates to Cartesian coordinates
    function geoCoordinatesToPosition(lat, lon) {
      const RADIUS = 1.5; // Distance from the camera, you may adjust this value
      const latRad = (lat * Math.PI) / 180;
      const lonRad = (lon * Math.PI) / 180;
      const x = -RADIUS * Math.cos(latRad) * Math.cos(lonRad);
      const y = RADIUS * Math.sin(latRad);
      const z = RADIUS * Math.cos(latRad) * Math.sin(lonRad);
      return { x, y, z };
    }

    // Get the model entity
    const model = document.querySelector('[gltf-model="#model"]');

    // Set the initial position of the model
    const initialPosition = geoCoordinatesToPosition(latitude, longitude);
    model.setAttribute("position", initialPosition);

    // Function to update model position as the camera moves
    function updatePosition() {
      if (AR.arToolkitSource.ready !== false) {
        const camera = document.querySelector("[camera]");
        const cameraPosition = camera.getAttribute("position");
        const position = {
          x: cameraPosition.x + initialPosition.x,
          y: cameraPosition.y + initialPosition.y,
          z: cameraPosition.z + initialPosition.z,
        };
        model.setAttribute("position", position);
      }
      requestAnimationFrame(updatePosition);
    }

    // Start updating the model position
    updatePosition();
  </script>
</body>
</html>
